<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Login - Ayush Singh</title>

  <!-- Favicons -->
  <link rel="icon" href="assets/img/favicon.ico" type="image/x-icon">
  <link rel="icon" type="image/png" sizes="16x16" href="assets/img/favicon-16x16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="assets/img/favicon-32x32.png">
  <link rel="apple-touch-icon" sizes="180x180" href="assets/img/apple-touch-icon.png">
  <link rel="manifest" href="assets/img/site.webmanifest">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="assets/css/main.css" rel="stylesheet">
</head>

<body class="login-page">
  <main class="main">
    <div class="login-container">
      <div class="login-card" data-aos="fade-up">
        <div class="login-header">
          <h1>Welcome Back!</h1>
          <p>Sign in to continue to your portfolio</p>
        </div>
        <div class="auth-buttons">
          <button onclick="signInWithGoogle()" class="auth-btn google-btn">
            <i class="bi bi-google"></i>
            Sign in with Google
          </button>
          <button onclick="signInWithGithub()" class="auth-btn github-btn">
            <i class="bi bi-github"></i>
            Sign in with GitHub
          </button>
        </div>
        <a href="index.html" class="back-home">
          <i class="bi bi-arrow-left"></i>
          Back to Home
        </a>
      </div>
    </div>
  </main>

  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner"></div>
  </div>

  <!-- Login Message -->
  <div id="loginMessage"></div>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/aos/aos.js"></script>
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>

  <script>
    // Initialize AOS
    AOS.init({
      duration: 1000,
      easing: 'ease-in-out',
      once: true,
      mirror: false
    });

    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyCKtIkEDVF8lVE2cyuvft5S4urfN6JKthQ",
      authDomain: "portfolio-website-e44c0.firebaseapp.com",
      projectId: "portfolio-website-e44c0",
      storageBucket: "portfolio-website-e44c0.appspot.com",
      messagingSenderId: "804676117496",
      appId: "1:804676117496:web:53d4acf4ec154535f2ec0d",
      measurementId: "G-CK458DNT87"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    // Auth providers
    const googleProvider = new firebase.auth.GoogleAuthProvider();
    const githubProvider = new firebase.auth.GithubAuthProvider();

    // Show loading overlay
    function showLoading() {
      document.getElementById('loadingOverlay').classList.add('show');
    }

    // Hide loading overlay
    function hideLoading() {
      document.getElementById('loadingOverlay').classList.remove('show');
    }

    // Show message
    function showMessage(message, isError = false) {
      const messageDiv = document.getElementById('loginMessage');
      messageDiv.textContent = message;
      messageDiv.className = isError ? 'error-message' : 'success-message';
      messageDiv.classList.add('show');
      setTimeout(() => {
        messageDiv.classList.remove('show');
      }, 5000);
    }

    // Sign in with Google
    async function signInWithGoogle() {
      showLoading();
      try {
        const result = await auth.signInWithPopup(googleProvider);
        showMessage('Successfully signed in!');
        // Store user data in localStorage
        localStorage.setItem('userName', result.user.displayName);
        localStorage.setItem('userPhoto', result.user.photoURL);
        // Redirect to returnUrl or home page
        const params = new URLSearchParams(window.location.search);
        const returnUrl = params.get('returnUrl') || 'index.html';
        window.location.href = returnUrl;
      } catch (error) {
        console.error('Google sign-in error:', error);
        showMessage('Failed to sign in with Google: ' + error.message, true);
        hideLoading();
      }
    }

    // Sign in with GitHub
    async function signInWithGithub() {
      showLoading();
      try {
        const result = await auth.signInWithPopup(githubProvider);
        showMessage('Successfully signed in!');
        // Store user data in localStorage
        localStorage.setItem('userName', result.user.displayName);
        localStorage.setItem('userPhoto', result.user.photoURL);
        // Redirect to returnUrl or home page
        const params = new URLSearchParams(window.location.search);
        const returnUrl = params.get('returnUrl') || 'index.html';
        window.location.href = returnUrl;
      } catch (error) {
        console.error('GitHub sign-in error:', error);
        showMessage('Failed to sign in with GitHub: ' + error.message, true);
        hideLoading();
      }
    }

    // Check if user is already signed in
    auth.onAuthStateChanged(function(user) {
      if (user) {
        const params = new URLSearchParams(window.location.search);
        const returnUrl = params.get('returnUrl') || 'index.html';
        window.location.href = returnUrl;
      }
    });
  </script>
</body>

</html>
